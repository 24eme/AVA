<?php require_once(dirname(__FILE__).'/../bootstrap/common.php');

$t = new lime_test(65);

$csv = new DRDouaneCsvFile(dirname(__FILE__).'/../data/dr_douane.csv');
$csvExploitant = $csv->convert();
$csvBailleur = $csv->convert(DRDouaneCsvFile::BAILLEUR);

$t->diag("Tests sur les données Exploitant");
$lines = explode("\n", $csvExploitant);
$t->is($lines[0], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;1R545;Saint-Joseph rouge;;04;Superficie de récolte;2,4786;;;;", "La ligne 1 exploitant est ok");
$t->is($lines[1], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;1R545;Saint-Joseph rouge;;05;Récolte totale;105,18;;;;", "La ligne 2 exploitant est ok");
$t->is($lines[2], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;1R545;Saint-Joseph rouge;;09;Récolte en cave particulière. Volume obtenu;105,18;;;;", "La ligne 3 exploitant est ok");
$t->is($lines[3], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;1R545;Saint-Joseph rouge;;10;Volume en vinification;105,18;;;;", "La ligne 4 exploitant est ok");
$t->is($lines[4], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;1R545;Saint-Joseph rouge;;15;Vol. de vin avec AO/IGP avec/sans cépage dans la limite du rdt autorisé;104,10;;;;", "La ligne 5 exploitant est ok");
$t->is($lines[5], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;1R545;Saint-Joseph rouge;;16;Vol. vin dépassement du rdt autorisé en AOP à livrer aux usages industriels;3,03;;;;", "La ligne 6 exploitant est ok");
$t->is($lines[6], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;1R545;Saint-Joseph rouge;;19;Volume complémentaire individuel (VCI);2,00;;;;", "La ligne 7 exploitant est ok");
$t->is($lines[7], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;04;Superficie de récolte;0,2080;;;;", "La ligne 8 exploitant est ok");
$t->is($lines[8], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;05;Récolte totale;6,66;;;;", "La ligne 9 exploitant est ok");
$t->is($lines[9], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;08;Récolte apportée en cave coopérative par l'adhérent. Volume obtenu;6,66;7523700800;\"CAVE COOP DE NEUILLY\";;", "La ligne 10 exploitant est ok");
$t->is($lines[10], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;10;Volume en vinification;6,66;;;;", "La ligne 11 exploitant est ok");
$t->is($lines[11], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;15;Vol. de vin avec AO/IGP avec/sans cépage dans la limite du rdt autorisé;6,66;;;;", "La ligne 12 exploitant est ok");
$t->is($lines[12], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;16;Vol. vin dépassement du rdt autorisé en AOP à livrer aux usages industriels;0,13;;;;", "La ligne 13 exploitant est ok");
$t->is($lines[13], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;1R531S19;ARDECHE RG SYRAH N;;04;Superficie de récolte;0,8601;;;;", "La ligne 14 exploitant est ok");
$t->is($lines[14], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;1R531S19;ARDECHE RG SYRAH N;;05;Récolte totale;64,07;;;;", "La ligne 15 exploitant est ok");
$t->is($lines[15], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;1R531S19;ARDECHE RG SYRAH N;;08;Récolte apportée en cave coopérative par l'adhérent. Volume obtenu;60,31;7523700800;\"CAVE COOP DE NEUILLY\";;", "La ligne 16 exploitant est ok");
$t->is($lines[16], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;1R531S19;ARDECHE RG SYRAH N;;09;Récolte en cave particulière. Volume obtenu;3,76;;;;", "La ligne 17 exploitant est ok");
$t->is($lines[17], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;1R531S19;ARDECHE RG SYRAH N;;10;Volume en vinification;64,07;;;;", "La ligne 18 exploitant est ok");
$t->is($lines[18], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;1R531S19;ARDECHE RG SYRAH N;;15;Vol. de vin avec AO/IGP avec/sans cépage dans la limite du rdt autorisé;64,63;;;;", "La ligne 19 exploitant est ok");
$t->is($lines[19], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;1R531S19;ARDECHE RG SYRAH N;;16;Vol. vin dépassement du rdt autorisé en AOP à livrer aux usages industriels;1,29;;;;", "La ligne 20 exploitant est ok");
$t->is($lines[20], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;04;Superficie de récolte;0,0528;;;;", "La ligne 21 exploitant est ok");
$t->is($lines[21], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;05;Récolte totale;2,23;;;;", "La ligne 22 exploitant est ok");
$t->is($lines[22], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;08;Récolte apportée en cave coopérative par l'adhérent. Volume obtenu;2,23;7523700800;\"CAVE COOP DE NEUILLY\";;", "La ligne 23 exploitant est ok");
$t->is($lines[23], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;10;Volume en vinification;2,23;;;;", "La ligne 24 exploitant est ok");
$t->is($lines[24], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;15;Vol. de vin avec AO/IGP avec/sans cépage dans la limite du rdt autorisé;2,23;;;;", "La ligne 25 exploitant est ok");
$t->is($lines[25], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;16;Vol. vin dépassement du rdt autorisé en AOP à livrer aux usages industriels;0,04;;;;", "La ligne 26 exploitant est ok");
$t->is($lines[26], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;20;Nom du propriétaire bailleur à fruit;SFEIR;;;;", "La ligne 27 exploitant est ok");
$t->is($lines[27], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;21;N°PPM du bailleur à fruit;P21015999;;;;", "La ligne 28 exploitant est ok");
$t->is($lines[28], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3R071 AI;ARDECHE RG SYRAH N;;04;Superficie de récolte;0,0874;;;;", "La ligne 29 exploitant est ok");
$t->is($lines[29], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3R071 AI;ARDECHE RG SYRAH N;;05;Récolte totale;6,21;;;;", "La ligne 30 exploitant est ok");
$t->is($lines[30], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3R071 AI;ARDECHE RG SYRAH N;;08;Récolte apportée en cave coopérative par l'adhérent. Volume obtenu;6,21;7523700800;\"CAVE COOP DE NEUILLY\";;", "La ligne 31 exploitant est ok");
$t->is($lines[31], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3R071 AI;ARDECHE RG SYRAH N;;10;Volume en vinification;6,21;;;;", "La ligne 32 exploitant est ok");
$t->is($lines[32], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3R071 AI;ARDECHE RG SYRAH N;;15;Vol. de vin avec AO/IGP avec/sans cépage dans la limite du rdt autorisé;6,27;;;;", "La ligne 33 exploitant est ok");
$t->is($lines[33], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3R071 AI;ARDECHE RG SYRAH N;;16;Vol. vin dépassement du rdt autorisé en AOP à livrer aux usages industriels;0,12;;;;", "La ligne 34 exploitant est ok");
$t->is($lines[34], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3R071 AI;ARDECHE RG SYRAH N;;20;Nom du propriétaire bailleur à fruit;SFEIR;;;;", "La ligne 35 exploitant est ok");
$t->is($lines[35], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3R071 AI;ARDECHE RG SYRAH N;;21;N°PPM du bailleur à fruit;P21015999;;;;", "La ligne 36 exploitant est ok");
$t->is($lines[36], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3S071 CM;ARDECHE RS GAMAY N;;04;Superficie de récolte;0,2085;;;;", "La ligne 37 exploitant est ok");
$t->is($lines[37], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3S071 CM;ARDECHE RS GAMAY N;;05;Récolte totale;14,97;;;;", "La ligne 38 exploitant est ok");
$t->is($lines[38], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3S071 CM;ARDECHE RS GAMAY N;;08;Récolte apportée en cave coopérative par l'adhérent. Volume obtenu;14,97;7523700800;\"CAVE COOP DE NEUILLY\";;", "La ligne 39 exploitant est ok");
$t->is($lines[39], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3S071 CM;ARDECHE RS GAMAY N;;10;Volume en vinification;14,97;;;;", "La ligne 40 exploitant est ok");
$t->is($lines[40], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3S071 CM;ARDECHE RS GAMAY N;;15;Vol. de vin avec AO/IGP avec/sans cépage dans la limite du rdt autorisé;14,85;;;;", "La ligne 41 exploitant est ok");
$t->is($lines[41], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3S071 CM;ARDECHE RS GAMAY N;;16;Vol. vin dépassement du rdt autorisé en AOP à livrer aux usages industriels;0,30;;;;", "La ligne 42 exploitant est ok");
$t->is($lines[42], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3S071 CM;ARDECHE RS GAMAY N;;20;Nom du propriétaire bailleur à fruit;SFEIR;;;;", "La ligne 43 exploitant est ok");
$t->is($lines[43], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3S071 CM;ARDECHE RS GAMAY N;;21;N°PPM du bailleur à fruit;P21015999;;;;", "La ligne 44 exploitant est ok");

$t->diag("Tests sur les données Bailleur");
$lines = explode("\n", $csvBailleur);
$t->is($lines[0], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;1R545;Saint-Joseph rouge;;04;Superficie de récolte;2,4786;;;;", "La ligne 1 bailleur est ok");
$t->is($lines[1], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;04;Superficie de récolte;0,2080;;;;", "La ligne 2 bailleur est ok");
$t->is($lines[2], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;1R531S19;ARDECHE RG SYRAH N;;04;Superficie de récolte;0,8601;;;;", "La ligne 3 bailleur est ok");
$t->is($lines[3], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;04;Superficie de récolte;0,0528;;;;", "La ligne 4 bailleur est ok");
$t->is($lines[4], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;05;Récolte totale;0,34;;;;", "La ligne 5 bailleur est ok");
$t->is($lines[5], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;08;Récolte apportée en cave coopérative par l'adhérent. Volume obtenu;0,34;7523700800;\"CAVE COOP DE NEUILLY\";;", "La ligne 6 bailleur est ok");
$t->is($lines[6], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;10;Volume en vinification;0,34;;;;", "La ligne 7 bailleur est ok");
$t->is($lines[7], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;15;Vol. de vin avec AO/IGP avec/sans cépage dans la limite du rdt autorisé;0,34;;;;", "La ligne 8 bailleur est ok");
$t->is($lines[8], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3B073 AO;COL RHODANIENNES BL VIOGNIER B;;16;Vol. vin dépassement du rdt autorisé en AOP à livrer aux usages industriels;0,01;;;;", "La ligne 9 bailleur est ok");
$t->is($lines[9], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3R071 AI;ARDECHE RG SYRAH N;;04;Superficie de récolte;0,0874;;;;", "La ligne 10 bailleur est ok");
$t->is($lines[10], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3R071 AI;ARDECHE RG SYRAH N;;05;Récolte totale;0,93;;;;", "La ligne 11 bailleur est ok");
$t->is($lines[11], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3R071 AI;ARDECHE RG SYRAH N;;08;Récolte apportée en cave coopérative par l'adhérent. Volume obtenu;0,93;7523700800;\"CAVE COOP DE NEUILLY\";;", "La ligne 12 bailleur est ok");
$t->is($lines[12], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3R071 AI;ARDECHE RG SYRAH N;;10;Volume en vinification;0,93;;;;", "La ligne 13 bailleur est ok");
$t->is($lines[13], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3R071 AI;ARDECHE RG SYRAH N;;15;Vol. de vin avec AO/IGP avec/sans cépage dans la limite du rdt autorisé;0,94;;;;", "La ligne 14 bailleur est ok");
$t->is($lines[14], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3R071 AI;ARDECHE RG SYRAH N;;16;Vol. vin dépassement du rdt autorisé en AOP à livrer aux usages industriels;0,02;;;;", "La ligne 15 bailleur est ok");
$t->is($lines[15], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3S071 CM;ARDECHE RS GAMAY N;;04;Superficie de récolte;0,2085;;;;", "La ligne 16 bailleur est ok");
$t->is($lines[16], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3S071 CM;ARDECHE RS GAMAY N;;05;Récolte totale;2,25;;;;", "La ligne 17 bailleur est ok");
$t->is($lines[17], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3S071 CM;ARDECHE RS GAMAY N;;08;Récolte apportée en cave coopérative par l'adhérent. Volume obtenu;2,25;7523700800;\"CAVE COOP DE NEUILLY\";;", "La ligne 18 bailleur est ok");
$t->is($lines[18], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3S071 CM;ARDECHE RS GAMAY N;;10;Volume en vinification;2,25;;;;", "La ligne 19 bailleur est ok");
$t->is($lines[19], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3S071 CM;ARDECHE RS GAMAY N;;15;Vol. de vin avec AO/IGP avec/sans cépage dans la limite du rdt autorisé;2,23;;;;", "La ligne 20 bailleur est ok");
$t->is($lines[20], "DR;2017;7523700100;\"ACTUALYS JEAN\";;NEUILLY;;;;;;;;;;3S071 CM;ARDECHE RS GAMAY N;;16;Vol. vin dépassement du rdt autorisé en AOP à livrer aux usages industriels;0,05;;;;", "La ligne 21 bailleur est ok");
