<?php

class TirageExploitationForm extends EtablissementForm
{
    protected $tirage = null;

    public function __construct(Tirage $object, $options = array(), $CSRFSecret = null) {
        $this->tirage = $object;
        parent::__construct($this->tirage->getEtablissementObject(), $options, $CSRFSecret);
    }
    
    public function configure() {
        parent::configure();

        $this->setWidget('lieu_stockage_same', new sfWidgetFormInputCheckbox());
        $this->setValidator('lieu_stockage_same', new sfValidatorBoolean(array('required' => false)));


        $this->setWidget('lieu_stockage', new sfWidgetFormInput());
        $this->getWidgetSchema()->setLabel('lieu_stockage', "Lieu de stockage");
        $this->setValidator('lieu_stockage', new sfValidatorString(array('required' => false)));
    }
    
    public function save($con = null) {
        parent::save($con);
    }

    protected function updateDefaultsFromObject() {
        parent::updateDefaultsFromObject();
        $this->setDefault('lieu_stockage_same', ($this->tirage->lieu_stockage) ? true : null);
        $this->setDefault('lieu_stockage', $this->tirage->lieu_stockage);
    }

    public function doUpdateObject($values) {
        parent::doUpdateObject($values);
        if(!$values['lieu_stockage_same'] && $values['lieu_stockage']) {
            $this->tirage->lieu_stockage = $values['lieu_stockage'];
        } else {
            $this->tirage->lieu_stockage = null; 
        }
    }
}